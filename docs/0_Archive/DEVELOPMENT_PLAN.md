# Next.js 项目 (gemini-balance-nextjs) 开发计划

本文档根据与 Python 参考项目的功能差距分析，制定了一个按优先级排序的开发工作清单。

## 优先级 1: 核心管理与可观察性

这些功能是提升项目可用性和可维护性的基础。

- [x] **引入数据库与日志持久化**

  - [x] 选择并集成一个数据库 (例如 Vercel Postgres, Supabase, or a simple file-based SQLite)。
  - [x] 创建数据表结构，用于存储 API 请求日志和错误日志。
  - [x] 修改 API 路由 (`route.ts`)，将每次请求的详细信息（使用的密钥、成功/失败状态、时间戳）记录到数据库。
  - [x] 将关键错误信息持久化到错误日志表中。

- [x] **创建基础的可视化管理后台**

  - [x] 创建一个新的页面路由 (例如 `/admin`)。
  - [x] 在后台页面上，从数据库中读取并展示 API 密钥的当前状态（可用/禁用）、连续失败次数和上次使用时间。
  - [x] 添加一个简单的日志查看器，用于显示最近的请求日志和错误日志。

- [x] **支持 Docker 化部署**
  - [x] 编写 `Dockerfile` 以便构建项目的生产版本。
  - [x] 添加 `docker-compose.yml` 文件，用于简化本地开发和部署流程（包括数据库服务）。
  - [x] 更新 `README.md`，加入 Docker 部署指南。

## 优先级 2: 增强配置与 API 完整性

这些功能将使项目更加灵活和完整。

- [x] **实现动态配置管理**

  - [x] 将配置（如 `MAX_FAILURES`）从环境变量移至数据库或一个可由后台编辑的 JSON 文件中。
  - [x] 在管理后台添加一个配置编辑页面，允许动态修改这些参数而无需重启服务。

- [x] **支持原生 Gemini API 代理**
  - [x] 创建一个新的 API 路由 (例如 `/api/gemini/v1beta/...`)。
  - [x] 实现该路由，使其能够直接代理 Gemini 原生格式的请求和响应，复用现有的 `KeyManager`。

## 优先级 3: 高级功能扩展

这些是锦上添花的功能，可以在核心稳定后再进行开发。

- [ ] **支持多模态（图文对话）**

  - [ ] 更新 `google-adapter.ts` 以支持处理包含图像数据的请求。
  - [ ] 修改前端页面，添加上传图片的功能。

- [ ] **兼容 OpenAI 图像生成 API**

  - [ ] 创建 `/api/v1/images/generations` 路由。
  - [ ] 实现调用 Gemini 图像生成模型 (如 Imagen) 的逻辑，并将其输出适配为 OpenAI 格式。

- [ ] **兼容 OpenAI Embeddings API**

  - [ ] 创建 `/api/v1/embeddings` 路由。
  - [ ] 实现调用 Gemini embedding 模型的逻辑，并将其输出适配为 OpenAI 格式。

- [ ] **集成网页搜索功能**
  - [ ] 研究 Gemini 的搜索工具调用功能。
  - [ ] 在 `openAiToGeminiRequest` 中添加逻辑，以在请求中启用搜索工具。
