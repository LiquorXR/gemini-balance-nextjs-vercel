# 后台管理界面 (Admin UI) 功能增强工作清单

**版本**: 1.0
**日期**: 2025 年 7 月 15 日
**基于文档**: `docs/1_Proposals_and_Specs/Project_Migration_Proposal_ZH.md` (第 13 节)

---

## 概述

本文档旨在根据 Python 参考项目的设计文档，梳理出当前 Next.js 版本后台管理界面需要实现或增强的功能。清单将分为三个主要部分，分别对应后台的三个核心功能区：**监控面板**、**配置编辑器**和**错误日志**。

---

## 1. 监控面板 (`/admin`)

此页面是系统的“驾驶舱”，需要提供高度信息化的实时概览和强大的密钥管理能力。

### 1.1. 统计仪表盘 (新增)

当前页面直接展示密钥列表，缺乏顶层的宏观统计。

- [x] **实现统计卡片**: 在页面顶部创建两张并排的统计卡片。
  - **密钥统计卡**: 显示“总密钥”、“有效密钥”、“无效密钥”的数量。
  - **API 调用统计卡**: 显示“1 分钟内”、“1 小时内”、“24 小时内”的 API 调用总次数。
- [x] **实现卡片交互功能**:
  - 点击任一卡片，应弹出一个模态框 (Modal)。
  - 模态框内展示更详细的统计数据，例如成功/失败的比例和次数，以及最近的请求记录。

### 1.2. 密钥列表与管理 (增强)

当前密钥列表功能较为基础，需大幅增强其管理效率。

- [x] **密钥分组与折叠**:
  - 将密钥列表明确分为“有效密钥”和“无效密钥”两个独立的区域。
  - 每个区域都应是可折叠的，允许管理员隐藏暂时不关注的列表。
- [x] **高级过滤与搜索**:
  - 在“有效密钥”列表上方，增加一套过滤工具栏。
  - **按失败次数筛选**: 提供一个输入框或滑块，允许筛选失败次数大于 N 次的密钥。
  - **按密钥片段搜索**: 提供一个搜索框，可以根据密钥的部分字符串（如最后几位）进行实时搜索。
- [x] **批量操作功能**:
  - 在每行密钥前增加一个复选框 (Checkbox)。
  - 实现一个“全选/取消全选”的功能。
  - 当有密钥被选中时，页面上方或固定位置出现一个“上下文工具栏”。
  - 工具栏提供以下批量操作按钮：**批量验证**、**批量重置失败计数**、**批量复制**、**批量删除**。
- [x] **单个密钥的精細化操作**:
  - 在每个密钥卡片或表格行中，增加一个“**查看详情**”按钮。
  - 点击后，弹出一个模态框，展示该密钥的详细调用历史记录（时间、模型、结果等）。

---

## 2. 配置编辑器 (`/admin/config`)

此页面是系统的“控制中心”，需要提供结构化、易于操作的配置管理体验。

### 2.1. 结构化与动态表单 (增强)

当前可能是一个较长的表单，需要优化其组织形式和交互。

- [x] **实现多层标签页 (Tabs)**:
  - 将所有配置项按功能域进行分类，例如：“通用 API 设置”、“模型配置”、“TTS 配置”、“图像生成配置”、“代理设置”等。
  - 使用标签页组件来组织这些分类，让用户可以清晰地在不同配置区之间切换。
- [x] **实现动态数组成员管理**:
  - 对于列表型配置（如 API 密钥、允许的访问令牌、代理服务器列表），提供一个动态的 UI 界面，而不是简单的文本域。
  - 用户可以独立添加或删除列表中的每一项。
  - 提供一个“**批量添加**”按钮，点击后弹出模态框，允许用户粘贴多行文本（如多个密钥）一次性导入。
- [x] **实现条件显示逻辑**:
  - 根据用户的选择动态显示或隐藏相关配置项。
  - **示例**: 在“图像生成”配置区，当“上传服务商”选择为 `SM.MS` 时，下方显示 `SM.MS` 的 API Key 输入框；选择 `Cloudflare` 时，则显示 `Cloudflare` 相关的账户和令牌输入框。
- [x] **增加辅助工具**:
  - 在“允许的访问令牌”配置项旁，增加一个“**随机生成令牌**”按钮，方便管理员快速创建高强度令牌。

---

## 3. 错误日志 (`/admin/logs`)

此页面是系统的“诊断仪”，需要提供高效的问题定位和追溯能力。

### 3.1. 高效筛选与查询 (增强)

当前日志查看功能可能仅支持基础搜索，需要增强其查询能力。

- [x] **实现多维度组合查询**:
  - 在日志表格上方创建一个功能完备的搜索/过滤区域。
  - 支持按 **API 密钥** 过滤。
  - 支持按 **错误类型** (如 `invalid_key`, `timeout`) 过滤。
  - 支持按 **HTTP 错误码** (如 `429`, `500`) 过滤。
  - 支持按 **时间范围** (提供日期选择器) 进行精确查询。

### 3.2. 深度细节钻取 (增强)

需要为问题排查提供更完整的上下文信息。

- [x] **实现详情模态框**:
  - 在日志表格的每一行增加一个“**查看详情**”按钮。
  - 点击后，弹出一个模态框，清晰地分块展示以下信息：
    - **完整的日志内容**: 完整的错误堆栈或日志消息。
    - **原始请求信息**: 触发该错误的原始请求体 (Request Body) JSON。
  - 模态框内的每个信息块（如日志、请求体）都应配有独立的“**复制**”按钮。

### 3.3. 日志管理功能 (新增)

- [x] **实现批量操作**:
  - 在日志表格的每一行前增加一个复选框 (Checkbox)。
  - 提供批量选择功能，并激活上下文工具栏。
  - 工具栏提供“**批量删除日志**”和“**批量复制关联密钥**”的功能。
- [x] **实现清空功能**:
  - 在页面上提供一个“**清空全部日志**”的按钮。
  - 由于这是危险操作，点击后必须弹出一个确认模态框，要求用户再次确认。
